---
// Lead Magnet Popup - 10% discount via Web3Forms
// Shows after 8 seconds, only once per session
---

<div id="lead-popup" class="lead-popup-overlay">
  <div class="lead-popup-container">
    <!-- Close button -->
    <button id="lead-popup-close" class="lead-popup-close" aria-label="Close popup">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>

    <!-- Content -->
    <div class="lead-popup-content">
      <!-- Left side - Branding (hidden on mobile) -->
      <div class="lead-popup-image">
        <img src="/images/hero-beach.jpg" alt="Boa Vista Beach" />
        <div class="lead-popup-image-overlay">
          <div class="text-white text-center p-6">
            <div class="text-5xl font-bold mb-2">10%</div>
            <div class="text-xl">OFF</div>
            <div class="text-sm mt-2 opacity-80">Your First Tour</div>
          </div>
        </div>
      </div>

      <!-- Right side - Web3Forms Form -->
      <div class="lead-popup-form-section">
        <div class="lead-popup-badge">Limited Time Offer</div>
        <h2 class="lead-popup-title">Get 10% Off Your First Adventure!</h2>
        <p class="lead-popup-text">Enter your email to receive your exclusive discount code.</p>

        <!-- Web3Forms Form -->
        <form id="lead-form" action="https://api.web3forms.com/submit" method="POST" class="lead-form">
          <input type="hidden" name="access_key" value="0f46b7a8-674b-4bde-a033-7a90bff01309" />
          <input type="hidden" name="subject" value="New 10% Discount Request - Boavista Go" />
          <input type="hidden" name="from_name" value="Boavista Go Discount Popup" />
          <input type="checkbox" name="botcheck" class="hidden" style="display: none" />

          <div class="form-group">
            <input
              type="text"
              name="name"
              required
              placeholder="Your name"
              class="lead-input"
            />
          </div>

          <div class="form-group">
            <input
              type="email"
              name="email"
              required
              placeholder="Your email address"
              class="lead-input"
            />
          </div>

          <button type="submit" class="lead-submit-btn">
            <span class="btn-text">Get My 10% Discount</span>
            <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
            </svg>
          </button>
        </form>

        <!-- Success Message (hidden by default) -->
        <div id="lead-success" class="lead-success hidden">
          <svg class="w-12 h-12 text-green-500 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <h3 class="text-lg font-bold text-dark mb-2">You're In!</h3>
          <p class="text-gray-600 text-sm">Check your email for your 10% discount code. See you on the beach!</p>
        </div>

        <p class="lead-privacy">
          <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
          </svg>
          We respect your privacy. Unsubscribe anytime.
        </p>
      </div>
    </div>
  </div>
</div>

<style>
  .lead-popup-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .lead-popup-overlay.is-visible {
    opacity: 1;
    visibility: visible;
  }

  .lead-popup-container {
    background: white;
    border-radius: 20px;
    max-width: 700px;
    width: 100%;
    max-height: 90vh;
    overflow: hidden;
    position: relative;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    transform: scale(0.9) translateY(20px);
    transition: transform 0.3s ease;
  }

  .lead-popup-overlay.is-visible .lead-popup-container {
    transform: scale(1) translateY(0);
  }

  .lead-popup-close {
    position: absolute;
    top: 12px;
    right: 12px;
    z-index: 10;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: white;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .lead-popup-close:hover {
    background: #f5f5f5;
    color: #333;
    transform: rotate(90deg);
  }

  .lead-popup-content {
    display: grid;
    grid-template-columns: 1fr 1.2fr;
  }

  @media (max-width: 640px) {
    .lead-popup-content {
      grid-template-columns: 1fr;
    }
  }

  .lead-popup-image {
    position: relative;
    min-height: 350px;
    display: none;
  }

  @media (min-width: 641px) {
    .lead-popup-image {
      display: block;
    }
  }

  .lead-popup-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .lead-popup-image-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(168, 32, 5, 0.9), rgba(168, 32, 5, 0.7));
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .lead-popup-form-section {
    padding: 32px;
    display: flex;
    flex-direction: column;
  }

  @media (max-width: 640px) {
    .lead-popup-form-section {
      padding: 24px;
      text-align: center;
    }
  }

  .lead-popup-badge {
    display: inline-block;
    background: linear-gradient(135deg, #a82005, #d32f2f);
    color: white;
    font-size: 12px;
    font-weight: 600;
    padding: 6px 12px;
    border-radius: 20px;
    margin-bottom: 16px;
    width: fit-content;
  }

  @media (max-width: 640px) {
    .lead-popup-badge {
      margin-left: auto;
      margin-right: auto;
    }
  }

  .lead-popup-title {
    font-family: 'Poppins', sans-serif;
    font-size: 24px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 8px;
    line-height: 1.3;
  }

  @media (max-width: 640px) {
    .lead-popup-title {
      font-size: 22px;
    }
  }

  .lead-popup-text {
    color: #666;
    font-size: 14px;
    margin-bottom: 20px;
    line-height: 1.6;
  }

  .lead-form {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .form-group {
    width: 100%;
  }

  .lead-input {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid #e5e5e5;
    border-radius: 10px;
    font-size: 15px;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
    outline: none;
  }

  .lead-input:focus {
    border-color: #a82005;
    box-shadow: 0 0 0 3px rgba(168, 32, 5, 0.1);
  }

  .lead-input::placeholder {
    color: #999;
  }

  .lead-submit-btn {
    width: 100%;
    padding: 14px 24px;
    background: linear-gradient(135deg, #a82005 0%, #8a1a04 100%);
    color: white;
    font-size: 15px;
    font-weight: 600;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    margin-top: 4px;
  }

  .lead-submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(168, 32, 5, 0.3);
  }

  .lead-submit-btn:active {
    transform: translateY(0);
  }

  .btn-icon {
    width: 18px;
    height: 18px;
  }

  .lead-success {
    text-align: center;
    padding: 20px 0;
  }

  .lead-success.hidden {
    display: none;
  }

  .lead-privacy {
    font-size: 12px;
    color: #999;
    text-align: center;
    margin-top: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .hidden {
    display: none;
  }
</style>

<script>
  const popup = document.getElementById('lead-popup');
  const closeBtn = document.getElementById('lead-popup-close');
  const form = document.getElementById('lead-form');
  const successMsg = document.getElementById('lead-success');

  // Check if popup was already shown in this session
  const popupShown = sessionStorage.getItem('leadPopupShown');

  // Show popup after 8 seconds if not already shown
  if (!popupShown && popup) {
    setTimeout(() => {
      popup.classList.add('is-visible');
      document.body.style.overflow = 'hidden';
    }, 8000);
  }

  // Close popup
  function closePopup() {
    popup?.classList.remove('is-visible');
    document.body.style.overflow = '';
    sessionStorage.setItem('leadPopupShown', 'true');
  }

  closeBtn?.addEventListener('click', closePopup);

  // Handle form submission
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);

    try {
      const response = await fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        body: formData
      });

      if (response.ok) {
        form.classList.add('hidden');
        successMsg?.classList.remove('hidden');

        // Close popup after 3 seconds
        setTimeout(() => {
          closePopup();
        }, 3000);
      } else {
        alert('Something went wrong. Please try again.');
      }
    } catch (error) {
      alert('Something went wrong. Please try again.');
    }
  });

  // Close on overlay click
  popup?.addEventListener('click', (e) => {
    if (e.target === popup) {
      closePopup();
    }
  });

  // Close on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && popup?.classList.contains('is-visible')) {
      closePopup();
    }
  });
</script>
